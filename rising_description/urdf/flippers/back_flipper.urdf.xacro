<?xml version="1.0"?>
<robot name="back_flipper" xmlns:xacro="http://www.ros.org/wiki/xacro">

    <xacro:include filename="$(find rising_description)/urdf/flippers/flipper.transmission.xacro"/>
    <xacro:include filename="$(find rising_description)/urdf/flippers/back_flipper.gazebo.xacro"/>
    <xacro:include filename="$(find rising_description)/urdf/inertia.urdf.xacro" />
    <xacro:include filename="$(find rising_description)/urdf/wheels/wheel.urdf.xacro" />

    <xacro:property name="M_PI" value="3.1415926535897931"/>
    <!-- Flippers -->
	<xacro:property name="back_flipper_radius" value="0.98"/> 
	<xacro:property name="back_flipper_height" value="0.196"/>
    <xacro:property name="back_flipper_mass" value="8"/> <!-- in kg--> 

    <xacro:property name="lenght_on_x" value="0.43"/>
	<xacro:property name="lenght_on_y" value="0.65"/>
	<xacro:property name="lenght_on_z" value="0.196"/>

	<xacro:property name="y_origin" value="0.274"/>

    <xacro:macro name="back_flipper" params="prefix parent *origin">
    
        <joint name="${prefix}flipper_joint" type="revolute">
            <parent link="${parent}"/>
            <child link="${prefix}flipper_link"/>
            <xacro:insert_block name="origin"/>
            <axis xyz="0 1 0" rpy="0 0 0"/>
            <limit lower="-3" upper="3" velocity="1.0" effort="10"/>
        </joint>
        
        <link name="${prefix}flipper_link">
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <geometry>
                    <mesh filename="package://rising_description/meshes/flippers/back_flipper.stl"/>
                </geometry>
            </visual>
            <!--collision>
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <geometry>
                    <mesh filename="package://rising_description/meshes/flippers/back_flipper.stl"/>
                </geometry>
            </collision-->
            <inertial>
                <mass value="${back_flipper_mass}"/>
                <origin xyz="-0.11 0 0"/>
                <solid_cuboid_inertia  w="${lenght_on_x}" h="${lenght_on_y}" d="${lenght_on_z}" m="${back_flipper_mass}"/>
            </inertial> 
        </link>

        <xacro:wheel prefix="${prefix}left_" parent="${prefix}flipper_link" y_origin="${y_origin}" reflect="true"/>
        <xacro:wheel prefix="${prefix}right_" parent="${prefix}flipper_link" y_origin="-${y_origin}" reflect="true"/>

        <xacro:flipper_transmission prefix="${prefix}"/>
        <xacro:back_flipper_gazebo prefix="${prefix}"/>
    
    </xacro:macro>

</robot>